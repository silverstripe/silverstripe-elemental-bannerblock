!function(e){function t(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t){e.exports=Injector},function(e,t){e.exports=React},function(e,t){e.exports=PropTypes},function(e,t){e.exports=classnames},function(e,t){e.exports=i18n},function(e,t,n){"use strict";var a=n(7),o=function(e){return e&&e.__esModule?e:{default:e}}(a);window.document.addEventListener("DOMContentLoaded",function(){(0,o.default)()})},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=n(16),l=a(i),r=n(1),u=a(r),c=n(14),s=a(c),f=n(0);l.default.entwine("ss",function(e){e(".js-injector-boot .form__field-holder .block-link-field[data-useEntwine]").entwine({createReactComponent:function(){var e=this.closest(".cms-content").attr("id"),t=e?{context:e}:{},n=(0,f.loadComponent)("BlockLinkField",t),a=this.data("schema"),i=this.data("state"),l=o({},i,a.data,{hideLabels:!0});s.default.render(u.default.createElement(n,l),this[0])},onmatch:function(){this.createReactComponent()},onunmatch:function(){s.default.unmountComponentAtNode(this[0])}})})},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=a(o),l=n(9),r=a(l),u=n(10),c=a(u);t.default=function(){i.default.component.registerMany({BlockLinkField:r.default,BlockLinkFieldActions:c.default})}},function(e,t,n){"use strict";n(6),n(5)},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n(1),f=a(s),d=n(2),p=a(d),h=n(12),k=a(h),m=n(11),v=a(m),y=n(4),b=a(y),g=n(3),_=a(g),C=n(13),O=n(0),M=(0,O.loadComponent)((0,C.createInsertLinkModal)("SilverStripe\\CMS\\Controllers\\CMSPageEditController","editorInternalLink")),L=function(e){function t(e){i(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleCloseModal=n.handleCloseModal.bind(n),n.handleClick=n.handleClick.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleSubmitModal=n.handleSubmitModal.bind(n),n.state={isDirty:!1,modalOpen:!1,value:{}},n}return r(t,e),c(t,[{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e=this.props.value,t=e?JSON.parse(e):{},n=this.state.value;["PageID","TargetBlank","Text","Description"].some(function(e){return t[e]!==n[e]})&&this.setState({value:t})}},{key:"getClassNames",value:function(){var e=this.props.extraClass;return(0,_.default)("form-control","d-flex","justify-content-start","p-2","align-items-center",e)}},{key:"getLinkRelativeUrl",value:function(){var e=this.getLinkedPage();if(e){return"/"+(e.URLSegment||e).replace(/^\/+/,"")}return""}},{key:"getActions",value:function(){var e=this;return v.default.LINK_ACTIONS.map(function(t){if(t.callback)return t;switch(t.value){case"clear":return u({},t,{callback:function(){e.setState({value:{}});var t=e.props.onChange;t&&t(JSON.stringify({}))}});default:return t}})}},{key:"getLinkedPage",value:function(){var e=this.props,t=e.linkedPage,n=e.data;return!n||t&&Object.keys(t).length?t:n.linkedPage}},{key:"registerChange",value:function(){this.setState({isDirty:!0})}},{key:"handleClick",value:function(e){"button"!==e.target.type&&this.setState({modalOpen:!0})}},{key:"handleKeyUp",value:function(e){13===e.keyCode&&this.handleClick(e)}},{key:"handleCloseModal",value:function(){this.setState({modalOpen:!1})}},{key:"handleSubmitModal",value:function(e){var t=(e.SecurityID,e.action_insert,o(e,["SecurityID","action_insert"]));this.setState({value:t});var n=this.props.onChange;n&&n(JSON.stringify(t)),this.registerChange(),this.handleCloseModal()}},{key:"renderActions",value:function(){var e=this.props.BlockLinkFieldActionsComponent,t={id:"foo",actions:this.getActions()};return e?f.default.createElement("div",{className:"block-link-field__actions"},f.default.createElement(e,t)):null}},{key:"renderLinkContent",value:function(){var e=this.state,t=e.isDirty,n=e.value,a=(0,_.default)("align-self-center","block-link-field__content","mr-auto","d-flex","justify-content-start");if(t)return f.default.createElement("span",{className:a},f.default.createElement("span",{className:"block-link-field__content--message-modified"},b.default._t("BlockLinkField.ModifiedMessage","Changes will be visible upon save")));var o=this.getLinkedPage();return n.PageID&&o.URLSegment?f.default.createElement("span",{className:a},n.Text&&f.default.createElement("span",{className:"block-link-field__title"},n.Text),f.default.createElement("span",{className:"block-link-field__link"},this.getLinkRelativeUrl())):f.default.createElement("span",{className:a},f.default.createElement("span",{className:"block-link-field__content--message-add-link"},b.default._t("BlockLinkField.AddLinkMessage","Add link")))}},{key:"renderModal",value:function(){var e=this.props,t=e.title,n=e.showLinkText,a=e.InsertModalLinkComponent,o=this.state,i=o.modalOpen,l=o.value;return f.default.createElement(a,{isOpen:i,onInsert:this.handleSubmitModal,onClosed:this.handleCloseModal,title:t,fileAttributes:l,bodyClassName:"modal__dialog",identifier:"Admin.InsertLinkInternalModal",requireLinkText:n})}},{key:"render",value:function(){var e=this.props.name,t=this.state.value;return f.default.createElement("div",{className:this.getClassNames(),onClick:this.handleClick,onKeyUp:this.handleKeyUp,role:"button",tabIndex:0},f.default.createElement("span",{className:"block-link-field__icon"}),this.renderLinkContent(),this.renderActions(),f.default.createElement("input",{type:"hidden",name:e,value:JSON.stringify(t)}),this.renderModal())}}]),t}(s.Component),w=p.default.shape({URLSegment:p.default.string});L.propTypes={BlockLinkFieldActionsComponent:p.default.oneOfType([p.default.node,p.default.func]),extraClass:p.default.string,linkedPage:w,showLinkText:p.default.bool,onChange:p.default.func,title:p.default.string,value:p.default.string},L.defaultProps={linkedPage:{},showLinkText:!0,value:"{}",InsertModalLinkComponent:M},t.Component=L,t.default=(0,O.inject)(["BlockLinkFieldActions"],function(e){return{BlockLinkFieldActionsComponent:e}},function(){return"ElementEditor.BlockLinkFieldComponent"})((0,k.default)(L))},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(1),c=a(u),s=n(2),f=a(s),d=n(3),p=a(d),h=n(15),k=n(0),m=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleChangeValue=n.handleChangeValue.bind(n),n}return l(t,e),r(t,[{key:"getOptionByValue",value:function(e){return this.props.actions.find(function(t){return t.value===e})}},{key:"handleChangeValue",value:function(e){e.stopPropagation();var t=this.getOptionByValue(e.target.value);return void 0===t?null:"function"==typeof t.confirm?t.confirm().then(function(){return t.callback()}).catch(function(e){if("cancelled"!==e)throw e}):t.callback()||Promise.resolve()}},{key:"render",value:function(){var e=this,t=this.props,n=t.id,a=t.actions,o=t.ActionMenu,i=a.map(function(t){var n=(0,p.default)("block-link-field__action","dropdown-item",t.className||"");return c.default.createElement(h.DropdownItem,{type:"button",className:n,key:t.value,onClick:e.handleChangeValue,value:t.value},t.label)}).filter(function(e){return e});return i.length?c.default.createElement("div",{className:"block-link-field-actions fieldholder-small input-group"},c.default.createElement(o,{id:n,className:"block-link-field-actions__menu"},i)):null}}]),t}(u.Component);m.propTypes={id:f.default.string.isRequired,actions:f.default.arrayOf(f.default.shape({value:f.default.string.isRequired,label:f.default.string.isRequired,className:f.default.string,destructive:f.default.bool,callback:f.default.func,canApply:f.default.func,confirm:f.default.func})),ActionMenu:f.default.oneOfType([f.default.node,f.default.func])},m.defaultProps={id:"",actions:[],ActionMenu:null},t.Component=m,t.default=(0,k.inject)(["ActionMenu"],function(e){return{ActionMenu:e}},function(){return"BlockLinkFieldActions"})(m)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={LINK_ACTIONS:[{value:"clear",label:o.default._t("BlockLinkField.ClearLink","Clear link"),className:"",destructive:!0,canApply:function(){return!0},callback:null}]}},function(e,t){e.exports=FieldHolder},function(e,t){e.exports=InsertLinkModal},function(e,t){e.exports=ReactDom},function(e,t){e.exports=Reactstrap},function(e,t){e.exports=jQuery}]);